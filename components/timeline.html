  <div id="timeline-wrapper"></div>

  <button type="button" class="btn btn-light view_settings_button" data-toggle="modal" data-target="#timeline_settings_modal">
    <span class="oi oi-cog"></span>
  </button>

  <div id="timeline_settings_modal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="false">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Timeline Options</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item active">
              <a href="#timelineConfigurations" id="timeline-tab" class="nav-link active" aria-controls="timeline" role="tab" data-toggle="tab">Timeline</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane fade show active" id="timelineConfigurations" role="tabpanel" aria-labelledby="timeline-tab">
              <div class="form-group row">
                <div class="col-3">Date Column</div>
                <div class="col-9"><select id="date-column" class="custom-select custom-select-sm nodeVariables">
                  <option>None</option>
                  <option value="date" selected>Date</option>
                </select></div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <script type="text/javascript" src="node_modules/vis/dist/vis.min.js"></script>
  <script type="text/javascript" src="node_modules/moment/min/moment-with-locales.min.js"></script>
  <script type="text/javascript">
  var timeline = {destroy: function(){}};

  (function(){

    function drawTimeline(){
      timeline.destroy();
      var field = $('#date-column').val();
      timeline = new vis.Timeline(
        document.getElementById('timeline-wrapper'),
        session.data.nodes
          .filter(d => d[field] && d.visible)
          .map(d => ({
            id: d.id,
            content: d.id,
            start: moment('' + d[field]),
            type: 'point'
          })),
        {
          'height': $('#timeline-wrapper').parent().height(),
          'multiselect': true
        }
      );
      timeline.setSelection(session.data.nodes.filter(d => d.visible && d.selected).map(d => d.id));
    }

    $('#date-column').change(drawTimeline);

    setTimeout(function(){
      ['date', 'Date', 'DATE'].forEach(name => {
        if(session.data.nodeFields.includes(name)){
          $('#date-column').val(name);
        }
      });

      drawTimeline();

      var field = $('#date-column').val();

      timeline.addCustomTime(_.max(session.data.nodes.map(d => moment('' + d[field]))));

      timeline.on('timechanged', function(e){
        var field = $('#date-column').val();
        session.state.time = moment(e.time);
        app.setNodeVisibility();
        timeline.setItems(session.data.nodes
          .filter(d => d[field] && d.visible)
          .map(d => ({
            id: d.id,
            content: d.id,
            start: moment('' + d[field]),
            type: 'point'
          })));
      });

      timeline.on('select', function(properties){
        session.data.nodes.forEach(d => d.selected = properties.items.includes(d.id));
        $(window).trigger('node_selected');
      });
    }, 100);

    $(window).on('node_selected', e => {
      timeline.setSelection(session.data.nodes.filter(d => d.visible && d.selected).map(d => d.id));
    });

  })();

  </script>
