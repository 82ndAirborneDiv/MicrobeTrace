  <link rel="stylesheet" type="text/css" href="node_modules/msa/css/msa.css" />

  <div id="sequences_panel"></div>

  <div id="sequences_view_controls" class="view_controls">
    <button type="button" class="btn btn-light btn-sm invisible">
      <span class="oi oi-cog"></span>
    </button>
    <button type="button" class="btn btn-light btn-sm" data-toggle="modal" data-target="#sequences_export_modal">
      <span class="oi oi-data-transfer-download"></span>
    </button>
  </div>

  <div id="sequences_export_modal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="false">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Export Sequences</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group row">
            <div class="col-9">
              <input type="text" id="export-sequences-file-name" class="form-control form-control-sm" placeholder="Filename" />
            </div>
            <div class="col-3">
              <select id="export-sequences-file-type" class="form-control form-control-sm">
                <option selected>fasta</option>
                <option>mega</option>
                <option>png</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-error" data-dismiss="modal">Cancel</button>
          <button type="button" id="sequences_export" class="btn btn-primary" data-dismiss="modal">Export</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <script src="node_modules/msa/dist/msa.js"></script>
  <script>
  (function(){
    var m = new msa.msa({
      el: $('#sequences_panel').get(0),
      vis: {
        overviewbox: true,
        bootstrapMenu: true,
        labels: false,
        labelId: false
      },
      zoomer: {
        menuFontsize: '12px',
        autoResize: true,
        currentSize: -20
      },
      seqs: session.data.nodes.filter(d => d.seq).map((node, i) => ({
        'details': {'en': node.id},
        'id': node.id,
        'name': node.id,
        'seq': node.seq
      }))
    });
    m.addView('menu', new msa.menu.defaultmenu({msa: m}));
    m.render();
    var menubuttons = $('.smenubar > div');
    [0,2,3,6,7,8,9].forEach(i => $(menubuttons.get(i)).hide());
    $('.smenubar').detach().insertAfter('#sequences_view_controls');

    $('#sequences_export').click(function(){
      var type = $('#export-sequences-file-type').val();
      if(type === 'fasta'){
        var blob = new Blob([app.unparseFASTA(session.data.nodes.filter(d => d.seq))]);
        saveAs(blob, $('#export-sequences-file-name').val() + '.fasta');
      } else if(type === 'mega'){
        var blob = new Blob([app.unparseMEGA(session.data.nodes.filter(d => d.seq))]);
        saveAs(blob, $('#export-sequences-file-name').val() + '.mega');
      } else if(type === 'png'){
        $('.biojs_msa_overviewbox').get(0).toBlob(function(blob){
          saveAs(blob, $('#export-sequences-file-name').val() + '.png');
        });
      }
    });
  })();
  </script>
