!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}({1:function(e,t,n){"use strict";var s=function(e){var t=e.toLowerCase().replace(/_/g," ");return"id"===t?"ID":"tn93"===t?"TN93":"snps"===t?"SNPs":"2d network"===t?"2D Network":"3d network"===t?"3D Network":"geo map"===t?"Map":t.replace(/(?:^|\s|-)\S/g,function(e){return e.toUpperCase()})};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a={componentCache:{},dataSkeleton:function(){return{nodes:[],links:[],clusters:[],distance_matrix:{},trees:{},nodeFields:["index","id","selected","cluster","visible","degree","origin"],linkFields:["index","source","target","visible","cluster","origin"],clusterFields:["id","index","nodes","links","sum_distances","links_per_node","mean_genetic_distance","visible"],reference:"CCTCAGGTCACTCTTTGGCAACGACCCCTCGTCACAATAAAGATAGGGGGGCAACTAAAGGAAGCTCTATTAGATACAGGAGCAGATGATACAGTATTAGAAGAAATGAGTTTGCCAGGAAGATGGAAACCAAAAATGATAGGGGGAATTGGAGGTTTTATCAAAGTAAGACAGTATGATCAGATACTCATAGAAATCTGTGGACATAAAGCTATAGGTACAGTATTAGTAGGACCTACACCTGTCAACATAATTGGAAGAAATCTGTTGACTCAGATTGGTTGCACTTTAAATTTTCCCATTAGCCCTATTGAGACTGTACCAGTAAAATTAAAGCCAGGAATGGATGGCCCAAAAGTTAAACAATGGCCATTGACAGAAGAAAAAATAAAAGCATTAGTAGAAATTTGTACAGAGATGGAAAAGGAAGGGAAAATTTCAAAAATTGGGCCTGAAAATCCATACAATACTCCAGTATTTGCCATAAAGAAAAAAGACAGTACTAAATGGAGAAAATTAGTAGATTTCAGAGAACTTAATAAGAGAACTCAAGACTTCTGGGAAGTTCAATTAGGAATACCACATCCCGCAGGGTTAAAAAAGAAAAAATCAGTAACAGTACTGGATGTGGGTGATGCATATTTTTCAGTTCCCTTAGATGAAGACTTCAGGAAGTATACTGCATTTACCATACCTAGTATAAACAATGAGACACCAGGGATTAGATATCAGTACAATGTGCTTCCACAGGGATGGAAAGGATCACCAGCAATATTCCAAAGTAGCATGACAAAAATCTTAGAGCCTTTTAGAAAACAAAATCCAGACATAGTTATCTATCAATACATGGATGATTTGTATGTAGGATCTGACTTAGAAATAGGGCAGCATAGAACAAAAATAGAGGAGCTGAGACAACATCTGTTGAGGTGGGGACTTACCACACCAGACAAAAAACATCAGAAAGAACCTCCATTCCTTTGGATGGGTTATGAACTCCATCCTGATAAATGGACAGTACAGCCTATAGTGCTGCCAGAAAAAGACAGCTGGACTGTCAATGACATACAGAAGTTAGTGGGGAAATTGAATTGGGCAAGTCAGATTTACCCAGGGATTAAAGTAAGGCAATTATGTAAACTCCTTAGAGGAACCAAAGCACTAACAGAAGTAATACCACTAACAGAAGAAGCAGAGCTAGAACTGGCAGAAAACAGAGAGATTCTAAAAGAACCAGTACATGGAGTGTATTATGACCCATCAAAAGACTTAATAGCAGAAATACAGAAGCAGGGGCAAGGCCAATGGACATATCAAATTTATCAAGAGCCATTTAAAAATCTGAAAACAGGAAAATATGCAAGAATGAGGGGTGCCCACACTAATGATGTAAAACAATTAACAGAGGCAGTGCAAAAAATAACCACAGAAAGCATAGTAATATGGGGAAAGACTCCTAAATTTAAACTGCCCATACAAAAGGAAACATGGGAAACATGGTGGACAGAGTATTGGCAAGCCACCTGGATTCCTGAGTGGGAGTTTGTTAATACCCCTCCCTTAGTGAAATTATGGTACCAGTTAGAGAAAGAACCCATAGTAGGAGCAGAAACCTTC"}},defaultWidgets:{"3DNet-link-tooltip-variable":"None","3DNet-link-transparency":0,"3DNet-link-width":1.6,"3DNet-node-tooltip-variable":"id","3DNet-node-radius":4,"3DNet-node-radius-variable":"None","background-color":"#ffffff","background-color-contrast":"#000000","bubble-x":"None","bubble-y":"None","bubble-size":5,"flow-showNodes":"selected","heatmap-metric":"tn93","heatmap-invertX":!1,"heatmap-invertY":!1,"heatmap-color-high":"#a50026","heatmap-color-medium":"#ffffbf","heatmap-color-low":"#313695","heatmap-axislabels-show":!1,"histogram-axis-x":!0,"histogram-scale-log":!1,"histogram-variable":"links-tn93","link-color":"#a6cee3","link-color-variable":"None","link-directed":!1,"link-label-variable":"None","link-length":.125,"link-opacity":0,"link-tooltip-variable":"None","link-width":3,"link-width-variable":"None","link-width-reciprocal":!0,"map-basemap-show":!1,"map-counties-show":!1,"map-countries-show":!0,"map-field-lat":"None","map-field-lon":"None","map-field-tract":"None","map-field-zipcode":"None","map-field-county":"None","map-field-state":"None","map-field-country":"None","map-link-show":!1,"map-link-tooltip-variable":"None","map-link-transparency":0,"map-node-jitter":0,"map-node-show":!0,"map-node-tooltip-variable":"id","map-node-transparency":0,"map-satellite-show":!1,"map-states-show":!0,"network-friction":.4,"network-gravity":.05,"node-charge":200,"node-color":"#1f77b4","node-color-variable":"None","node-highlight":!1,"node-label-size":16,"node-label-variable":"None","node-radius":250,"node-radius-variable":"None","node-symbol":"symbolCircle","node-symbol-variable":"None","node-tooltip-variable":"id","scatterplot-xVar":"snps","scatterplot-yVar":"tn93","scatterplot-logScale":!1,"scatterplot-showNodes":!1,"selected-color":"#ff8300","selected-color-contrast":"#000000","tree-epsilon":-10,"tree-metric":"tn93","tree-layout-circular":!1,"tree-labels-align":!1,"tree-labels-show":!0},sessionSkeleton:function(){return{data:a.dataSkeleton(),files:[],layout:{content:[{type:"files"}],type:"stack"},meta:{loadTime:0,startTime:0},network:{allPinned:!1,nodes:[]},state:{linkSortVariable:"tn93",linkThreshold:.015,metrics:["tn93","snps"],timeStart:0,timeEnd:Date.now()},style:{linkColors:d3.schemePaired,nodeColors:[d3.schemeCategory10[0]].concat(d3.schemeCategory10.slice(2)),nodeSymbols:["symbolCircle","symbolCross","symbolDiamond","symbolSquare","symbolStar","symbolTriangle","symbolWye","symbolTriangleDown","symbolTriangleLeft","symbolTriangleRight","symbolDiamondAlt","symbolDiamondSquare","symbolPentagon","symbolHexagon","symbolHexagonAlt","symbolOctagon","symbolOctagonAlt","symbolX"],widgets:a.defaultWidgets},warnings:[]}},tempSkeleton:function(){return{style:{linkColorMap:function(){return session.style.widgets["link-color"]},nodeColorMap:function(){return session.style.widgets["node-color"]},nodeSymbolMap:function(){return session.style.widgets["node-symbol"]}}}},defaultNode:function(){return{index:session.data.nodes.length,id:"",selected:!1,cluster:1,visible:!0,degree:0,origin:[]}},addNode:function(e){"number"==typeof e.id&&(e.id=""+e.id);var t=session.data.nodes.find(function(t){return t.id===e.id});return t?(e.origin&&(e.origin=e.origin.concat(t.origin)),Object.assign(t,e),0):("seq"in e&&(e._seqInt=e.seq.split("").map(function(e){return tn93.mapChar[e.charCodeAt(0)]})),session.data.nodes.push(Object.assign(a.defaultNode(),e)),1)},defaultLink:function(){return{index:session.data.links.length,source:"",target:"",visible:!1,cluster:1,origin:[]}},addLink:function(e,t){if(e.source!==e.target){var n=session.data.links;if(t)for(var s=n.length,o=0;o<s;o++){var i=n[o];if(i.source==e.source&&i.target==e.target||i.source==e.target&&i.target==e.source)return e.origin&&!i.origin.includes(e.origin)&&(e.origin=e.origin.concat(i.origin)),Object.assign(i,e),0}return session.state.metrics.forEach(function(t){e[t]=parseFloat(e[t])}),n.push(Object.assign(a.defaultLink(),e)),1}},processJSON:function(e,t){var n;try{n=JSON.parse(e)}catch(e){return alertify.error("File Not Recognized! Are you certain this is a MicrobeTrace Session or HIV-TRACE Output File?"),void console.error(e)}"microbetrace"===t?a.applySession(n):a.applyHIVTrace(n)},applyHIVTrace:function(e){session=a.sessionSkeleton(),session.meta.startTime=Date.now(),e.trace_results.Nodes.forEach(function(e){var t=JSON.parse(JSON.stringify(e.patient_attributes));t.id=e.id,t.origin="HIVTRACE Import",a.addNode(t)}),Object.keys(e.trace_results.Nodes[0].patient_attributes).forEach(function(e){session.data.nodeFields.includes(e)||session.data.nodeFields.push(e)});for(var t=e.trace_results.Edges.length,n=0;n<t;n++){var s=e.trace_results.Edges[n];a.addLink({source:""+s.sequences[0],target:""+s.sequences[1],distance:parseFloat(s.length),origin:["HIVTRACE Import"],visible:!0},!1)}a.finishUp()},parseFASTA:function(e){if(!e||0===e.length)return[];var t=[],n={};return e.split(/[\r\n]+/g).forEach(function(e,s){/^\s*$/.test(e)||(">"===e[0]||";"===e[0]?(s>0&&t.push(n),n={id:e.slice(1),seq:""}):n.seq+=e)}),t.push(n),t}};a.decoder=new TextDecoder("utf-8"),a.align=function(e,t){if("none"!==e.aligner){Date.now();var n=e.nodes.length;aligner=new Worker("scripts/align-"+e.aligner+".js"),aligner.onmessage=function(e){output=JSON.parse(a.decoder.decode(new Uint8Array(e.data.nodes))),console.log("Alignment transit time: ",((Date.now()-e.data.start)/1e3).toLocaleString(),"s"),Date.now();for(var s=Number.MAX_SAFE_INTEGER,o=0,i=0;i<n;i++){(r=output[i]).seq||(r.seq=""),s>r.padding&&(s=r.padding)}for(i=0;i<n;i++){(r=output[i]).seq="-".repeat(r.padding-s)+r.seq,delete r.padding,o<r.seq.length&&(o=r.seq.length)}for(i=0;i<n;i++){var r;(r=output[i]).seq=r.seq+"-".repeat(o-r.seq.length)}console.log("Alignment Padding time: ",((Date.now()-e.data.start)/1e3).toLocaleString(),"s"),t(output)},aligner.postMessage(e)}else t&&t(e.nodes)},a.computeConsensus=function(e){var t=session.data.nodes.filter(function(e){return e.seq}),n=new Worker("scripts/compute-consensus.js");n.onmessage=function(t){consensus=a.decoder.decode(new Uint8Array(t.data.consensus)),console.log("Consensus Transit time: ",((Date.now()-t.data.start)/1e3).toLocaleString(),"s"),e&&e(consensus)},n.postMessage(t)},a.computeConsensusDistances=function(e){var t=Date.now(),n=new Worker("scripts/compute-consensus-distances.js");n.onmessage=function(n){var s=JSON.parse(a.decoder.decode(new Uint8Array(n.data.nodes)));console.log("Consensus Difference Transit time: ",((Date.now()-t)/1e3).toLocaleString(),"s"),e&&e(s)};for(var s=[],o=session.data.nodes.length,i=0;i<o;i++){var r=session.data.nodes[i];r.seq&&s.push({index:i,seq:r.seq})}n.postMessage({consensus:session.data.consensus,nodes:s})},a.computeLinks=function(e,t){var n=0,s=new Worker("scripts/compute-links.js");s.onmessage=function(e){var o=JSON.parse(a.decoder.decode(new Uint8Array(e.data.links)));console.log("Links Transit time: ",((Date.now()-e.data.start)/1e3).toLocaleString(),"s");var i=Date.now(),r=session.files.length>1;o.forEach(function(e,t){n+=a.addLink(e,r)}),s.terminate(),console.log("Links Merge time: ",((Date.now()-i)/1e3).toLocaleString(),"s"),t(n)},s.postMessage({nodes:e,metrics:session.state.metrics})},a.computeDM=function(e){var t=new Worker("scripts/compute-dm.js");t.onmessage=function(t){session.data.distance_matrix=JSON.parse(a.decoder.decode(new Uint8Array(t.data.matrices))),console.log("DM Transit time: ",((Date.now()-t.data.start)/1e3).toLocaleString(),"s"),e&&e()},t.postMessage({nodes:session.data.nodes,links:session.data.links.filter(function(e){return session.state.metrics.map(function(t){return"number"==typeof e[t]}).indexOf(!0)>-1}),metrics:session.state.metrics})},a.computeTree=function(e,t){var n=new Worker("scripts/compute-tree.js");n.onmessage=function(n){session.data.trees[e]=a.decoder.decode(new Uint8Array(n.data.tree)),console.log("Tree ("+e+") Transit time: ",((Date.now()-n.data.start)/1e3).toLocaleString(),"s"),t&&t()};var s=-10==session.style.widgets["tree-epsilon"]?0:Math.pow(10,session.style.widgets["tree-epsilon"]);n.postMessage({matrix:session.data.distance_matrix[e].map(function(e){return e.map(function(e){return Math.max(e,s)})}),labels:session.data.distance_matrix.labels,round:session.style.widgets["tree-round"],addOne:session.style.widgets["tree-addOne"]})},a.computePatristicMatrix=function(e,t){var n=new Worker("scripts/compute-patristic-matrix.js");n.onmessage=function(n){var s=JSON.parse(a.decoder.decode(new Uint8Array(n.data.output)));session.data.distance_matrix["patristic-"+e]=s.matrix,session.data.distance_matrix["patristic-"+e].labels=s.labels,console.log("Patristic Matrix ("+e+") Transit time: ",((Date.now()-n.data.start)/1e3).toLocaleString(),"s"),t&&t()},n.postMessage({newick:session.data.trees[e]})},a.computeNN=function(e,t){if(session.data.distance_matrix[e]){var n=new Worker("scripts/compute-nn.js");n.onmessage=function(e){if("Error"!==e.data){var n=JSON.parse(a.decoder.decode(new Uint8Array(e.data.links)));console.log("NN Transit time: ",((Date.now()-e.data.start)/1e3).toLocaleString(),"s");var s=Date.now();n.forEach(function(e){session.data.links[e.index].nn=e.nn}),console.log("NN Merge time: ",((Date.now()-s)/1e3).toLocaleString(),"s"),t&&t()}else console.error("Nearest Neighbor washed out")},n.postMessage({links:session.data.links,nodes:session.data.nodes,matrix:session.data.distance_matrix[e]})}else console.error("Couldn't find Distance Matrix "+e+" to compute Nearest Neighbors.")},a.capitalize=function(e){return e.toUpperCase()},a.titleize=function(e){var t=e.toLowerCase().replace(/_/g," ");return"id"===t?"ID":"tn93"===t?"TN93":"snps"===t?"SNPs":"2d network"===t?"2D Network":"3d network"===t?"3D Network":"geo map"===t?"Map":t.replace(/(?:^|\s|-)\S/g,a.capitalize)},a.tagClusters=function(){session.data.clusters=[],session.data.nodes.forEach(function(e){delete e.cluster}),session.data.nodes.forEach(function(e){void 0===e.cluster&&(session.data.clusters.push({id:session.data.clusters.length,nodes:0,links:0,sum_distances:0,links_per_node:0,mean_genetic_distance:void 0,visible:!0}),a.DFS(e))}),session.data.clusters=session.data.clusters.filter(function(e){return e.nodes>1})},a.DFS=function(e){if("string"==typeof e&&(e=session.data.nodes.find(function(t){return t.id===e})),void 0===e&&console.error("That's weird: An undefined node was referenced."),void 0===e.cluster){var t=$("#links-filter-variable").val();e.cluster=session.data.clusters.length-1,session.data.clusters[session.data.clusters.length-1].nodes++,session.data.links.forEach(function(n){if(n.visible&&(n.source===e.id||n.target===e.id)){n.cluster=session.data.clusters.length-1;var s=session.data.clusters[session.data.clusters.length-1];s.links++,s.sum_distances+=parseFloat(n[t]),n.source.cluster||a.DFS(n.source),n.target.cluster||a.DFS(n.target)}})}},a.computeDegree=function(){session.data.nodes.forEach(function(e){e.degree=0});for(var e=session.data.links.length,t=0;t<e;t++){var n=session.data.links[t];n.visible&&(session.data.nodes.find(function(e){return e.id===n.source}).degree++,session.data.nodes.find(function(e){return e.id===n.target}).degree++)}session.data.clusters.forEach(function(e){e.links=e.links/2,e.links_per_node=e.links/e.nodes,e.mean_genetic_distance=e.sum_distances/2/e.links})},a.setNodeVisibility=function(){var e=$("#ShowSingletons").is(":checked"),t=$("#date-column").val();session.data.nodes.forEach(function(n){var s=session.data.clusters.find(function(e){return e.id===n.cluster});n.visible=s?s.visible:e,session.state.time&&t&&(n.visible=n.visible&&session.state.time.isAfter(n[t]))}),$(window).trigger("node-visibility")},a.setLinkVisibility=function(){var e=$("#links-filter-variable").val(),t=parseFloat($("#link-threshold").val()),n=$("#links-show-nn").is(":checked");session.state.linkThreshold=t,session.data.links.forEach(function(s){if(s.visible=!0,n&&(s.visible&=s.nn),"none"!==e&&(s.visible&=s[e]<=t),session.data.clusters.length>0){var o=session.data.clusters.find(function(e){return e.id===s.cluster});o&&(s.visible&=o.visible)}})},a.getVisibleNodes=function(e){for(var t=session.data.nodes,n=t.length,s=[],o=0;o<n;o++){var i=t[o];i.visible&&(e?s.push(JSON.parse(JSON.stringify(i))):s.push(i))}return s},a.getVisibleLinks=function(e){var t=session.data.links,n=t.length,s=[];if(e)for(var o=0;o<n;o++){(i=t[o]).visible&&s.push(JSON.parse(JSON.stringify(i)))}else for(o=0;o<n;o++){var i;(i=t[o]).visible&&s.push(i)}return s},a.updateNetwork=function(e){a.setLinkVisibility(),a.tagClusters(),e&&a.setNodeVisibility(),a.computeDegree()},a.updateStatistics=function(){if(!$("#network-statistics-hide").is(":checked")){var e=a.getVisibleNodes(),t=a.getVisibleLinks(),n=e.filter(function(e){return 0===e.degree}).length;$("#numberOfSelectedNodes").text(e.filter(function(e){return e.selected}).length.toLocaleString()),$("#numberOfNodes").text(e.length.toLocaleString()),$("#numberOfVisibleLinks").text(t.length.toLocaleString()),$("#numberOfSingletonNodes").text(n.toLocaleString()),$("#numberOfDisjointComponents").text(session.data.clusters.length)}},a.createNodeColorMap=function(){var e=session.style.widgets["node-color-variable"];if("None"===e)return temp.style.nodeColorMap=function(){return session.style.widgets["node-color"]},[];if(values=i(Set(session.data.nodes.filter(function(e){return e.visible}).map(function(t){return t[e]}))),"number"==typeof session.data.nodes[0][e]?values.sort(function(e,t){return e-t}):values.sort(),values.length>session.style.nodeColors.length){for(var t=[],n=Math.ceil(values.length/session.style.nodeColors.length);n-- >0;)t=t.concat(session.style.nodeColors);session.style.nodeColors=t}return temp.style.nodeColorMap=d3.scaleOrdinal(session.style.nodeColors).domain(values),values},a.createLinkColorMap=function(){var e=session.style.widgets["link-color-variable"];if("None"===e)return temp.style.linkColorMap=function(){return session.style.widgets["link-color"]},[];var t=[];if("origin"===e?session.data.links.forEach(function(e){e.origin.forEach(function(e){t.includes(e)||t.push(e)})}):t=i(Set(session.data.links.filter(function(e){return e.visible}).map(function(t){return e}))),"number"==typeof session.data.links[0][e]?t.sort(function(e,t){return e-t}):t.sort(),t.length>session.style.linkColors.length){for(var n=[],s=Math.ceil(t.length/session.style.linkColors.length);s-- >0;)n=n.concat(session.style.linkColors);session.style.linkColors=n}return temp.style.linkColorMap=d3.scaleOrdinal(session.style.linkColors).domain(t),t},a.applyStyle=function(e){for(var t in session.style=e,session.style.widgets=Object.assign({},a.defaultWidgets,session.style.widgets),a.createLinkColorMap(),a.createNodeColorMap(),session.style.widgets)$id=$("#"+t),$id.length>0&&(["radio","checkbox"].includes($id[0].type)?session.style.widgets[t]&&$id.trigger("click"):$id.val(session.style.widgets[t]).trigger("change"))},a.applySession=function(e,t){session=e,t||(t=Date.now()),session.meta||(session.meta={}),session.meta.startTime=t,a.applyStyle(session.style),a.finishUp(!0)},a.reset=function(){$("#network-statistics-hide, #color-table-hide").parent().trigger("click"),$("#SettingsTab").attr("data-target","#aligner-controls-modal"),window.session=a.sessionSkeleton(),layout.unbind("stateChanged"),layout.root.replaceChild(layout.root.contentItems[0],{type:"stack",content:[]}),layout.contentItems=[],a.launchView("files")},a.haversine=function(e,t){var n=Math.PI/180,s=e._lat*n,o=t._lat*n,i=(t._lon-e._lon)*n,a=(t._lat-e._lat)*n;e=Math.cos(s)*Math.cos(o)*Math.sin(i/2)*Math.sin(i/2)+Math.pow(Math.sin(a/2),2);return 6378.1*(2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e)))},a.geoDM=function(){for(var e=session.data.nodes,t=e.length,n=Array(t),s=0;s<t;s++){n[s]=Array(t),n[s][s]=0;for(var o=0;o<s;o++){var i=a.haversine(e[s],e[o]);n[s][o]=i,n[o][s]=i}}session.data.distance_matrix.geo=n},a.contrastColor=function(e){return 299*parseInt(e.substr(1,2),16)+587*parseInt(e.substr(3,2),16)+114*parseInt(e.substr(5,2),16)>=128e3?"#000000":"#ffffff"},a.launchView=function(e,t){if(a.componentCache[e]){var n=layout.contentItems.find(function(t){return t.componentName===e});if(n)n.parent.setActiveContentItem(n);else{var o=layout.root.contentItems[0].getItemsByType("stack"),i=o[o.length-1];i||(i=layout.root.contentItems[0]),i.addChild({componentName:e,componentState:{text:a.componentCache[e]},title:s(e),type:"component"}),(n=i.contentItems[i.contentItems.length-1]).on("itemDestroyed",function(){var e=layout.contentItems.findIndex(function(e){return e===n});layout.contentItems.splice(e,1)}),layout.contentItems.push(n)}for(var r in n.element.find("select.nodeVariables").html("<option>None</option>"+session.data.nodeFields.map(function(e){return'<option value="'+e+'">'+s(e)+"</option>"}).join("\n")),n.element.find("select.linkVariables").html("<option>None</option>"+session.data.linkFields.map(function(e){return'<option value="'+e+'">'+s(e)+"</option>"}).join("\n")),n.element.find("select.mixedVariables").html("<option>None</option>"+session.data.linkFields.map(function(e){return'<option value="links-'+e+'">Links '+s(e)+"</option>"}).concat(session.data.nodeFields.map(function(e){return'<option value="nodes-'+e+'">Nodes '+s(e)+"</option>"})).join("\n")),n.element.find(".launch-color-options").click(function(){$("#color-tab").tab("show"),setTimeout(function(){$("#global-settings-modal").modal("show")},250)}),navigator.onLine&&n.element.find(".ifOnline").show(),session.style.widgets)$id=$("#"+r),$id.length>0&&(["radio","checkbox"].includes($id[0].type)?session.style.widgets[r]&&$id.click():$id.val(session.style.widgets[r]));if(n.element.find('[data-toggle="tooltip"]').tooltip(),!t)return n;t(n)}else $.get("components/"+e+".html",function(n){if(a.componentCache[e]=n,layout.registerComponent(e,function(e,t){e.getElement().html(t.text)}),!t)return a.launchView(e);a.launchView(e,t)})},a.cacheLayout=function(e){return["stack","row","column"].includes(e.type)?{type:e.type,content:e.contentItems.map(a.cacheLayout)}:{type:e.componentName}},a.loadLayout=function(e,t){if(!t){t=layout.root;try{t.contentItems[0].remove()}catch(e){}}["stack","row","column"].includes(e.type)?(t.addChild({type:e.type}),e.content.forEach(function(e){a.loadLayout(e,t.contentItems[t.contentItems.length-1])})):a.launchView(e.type)},a.unparseFASTA=function(e){return e.map(function(e){return">"+e.id+"\r\n"+e.seq}).join("\r\n")},a.unparseMEGA=function(e){return e.map(function(e){return"#"+e.id+"\r\n"+e.seq}).join("\r\n")},a.unparseDM=function(e){var t=session.data.distance_matrix.labels;return","+t.join(",")+"\n"+e.map(function(e,n){return t[n]+","+e.join(",")}).join("\n")},a.unparseSVG=function(e){e.setAttribute("xlink","http://www.w3.org/1999/xlink");var t=[];t.push("#"+e.id);for(var n=0;n<e.classList.length;n++)("."+e.classList[n]).includes(t)||t.push("."+e.classList[n]);for(var s=e.getElementsByTagName("*"),o=0;o<s.length;o++){var i=s[o].id;("#"+i).includes(t)||t.push("#"+i);var a=s[o].classList;for(n=0;n<a.length;n++)("."+a[n]).includes(t)||t.push("."+a[n])}var r="";for(o=0;o<document.styleSheets.length;o++){var l=document.styleSheets[o];try{if(!l.cssRules)continue}catch(e){if("SecurityError"!==e.name)throw e;continue}for(var c=l.cssRules,d=0;d<c.length;d++)c[d].selectorText&&c[d].selectorText.includes(t)&&(r+=c[d].cssText)}var u=document.createElement("style");u.setAttribute("type","text/css"),u.innerHTML=r;var A=e.hasChildNodes()?e.children[0]:null;return e.insertBefore(u,A),(new XMLSerializer).serializeToString(e)},a.blobifySVG=function(e,t,n,s){var o=document.createElement("canvas");o.width=t,o.height=n;var i=new Image;i.onload=function(){var e=o.getContext("2d");e.clearRect(0,0,t,n),e.drawImage(i,0,0,t,n),o.toBlob(s)},i.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))},a.getHelp=function(e,t){$.get("help/"+e,function(e){t(marked(e))})},a.ab2str=function(e){return String.fromCharCode.apply(null,new Uint8Array(e))},a.str2ab=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint8Array(t),s=0,o=e.length;s<o;s++)n[s]=e.charCodeAt(s);return t},a.finishUp=function(e){e||a.computeDM(function(){$(".show-for-dm").css("display","flex"),a.computeNN(session.state.linkSortVariable,function(){$(".show-for-nn").css("display","flex")}),session.state.metrics.forEach(function(e){a.computeTree(e)})}),clearTimeout(messageTimeout),["node","link"].forEach(function(e){for(var t=session.data[e+"s"].length,n=session.data[e+"Fields"],s=0;s<t;s++){var o=session.data[e+"s"][s];n.forEach(function(e){e in o||(o[e]=null)})}}),$("#links-filter-variable").html(session.data.linkFields.map(function(e){return'<option value="'+e+'">'+s(e)+"</option>"}).join("\n")).val(session.state.linkSortVariable),$("#node-color-variable").html("<option selected>None</option>"+session.data.nodeFields.map(function(e){return'<option value="'+e+'">'+s(e)+"</option>"}).join("\n")),$("#link-color-variable").html("<option>None</option>"+session.data.linkFields.map(function(e){return'<option value="'+e+'">'+s(e)+"</option>"}).join("\n"));try{a.updateThresholdHistogram()}catch(e){console.error(e),$("#loading-information-modal").modal("hide"),alertify.error("Something went wrong! Please start a new session and try again.").delay(0).ondismiss(function(){window.location.reload()})}a.setLinkVisibility(),a.setNodeVisibility(),a.tagClusters(),a.computeDegree(),a.updateStatistics(),$("#network-statistics").fadeIn(),session.meta.loadTime=Date.now()-session.meta.startTime,e?(layout.root.contentItems[0].remove(),setTimeout(function(){a.loadLayout(session.layout)},80)):a.launchView($("#default-View").val()),"true"===localStorage.getItem("stash-auto")&&(temp.autostash={time:Date.now(),interval:setInterval(function(){var e=Date.now();localforage.setItem("stash-"+e+"-autostash",JSON.stringify(session)).then(function(){localforage.removeItem("stash-"+temp.autostash.time+"-autostash").then(function(){temp.autostash.time=e})})},6e4)}),$(".hideForHIVTrace").css("display","flex"),setTimeout(function(){var e=layout.contentItems.find(function(e){return"files"===e.componentName});e&&e.remove(),$("#loading-information-modal").modal("hide")},1200)},a.exportHIVTRACE=function(){var e=session.data.links.filter(function(e){return e.visible}),t=e.filter(function(e){return e.origin.includes("Genetic Distance")}),n=new Set;t.forEach(function(e){n.add(e.source).add(e.target)});var i={};return session.data.nodes.forEach(function(e){Object.keys(e).forEach(function(t){i[t]||(i[t]={label:t,type:s(o(e[t]))})})}),JSON.stringify({trace_results:{"Cluster sizes":session.data.clusters.map(function(e){return e.size}),Degrees:{Distribution:[],Model:"Waring",fitted:[],rho:0,"rho CI":[-1,1]},"Directed Edges":{Count:0,"Reasons for unresolved directions":{"Missing dates":e.length}},"Edge Stages":{},Edges:e.map(function(e){return{attributes:["BULK"],directed:!1,length:e[session.state.linkSortVariable],removed:!1,sequences:[e.source,e.target],source:session.data.nodes.findIndex(function(t){return t.id===e.source}),support:0,target:session.data.nodes.findIndex(function(t){return t.id===e.target})}}),"HIV Stages":{"A-1":0,"A-2":0,"A-3":0,Chronic:session.data.nodes.length,"E-1":0,"E-2":0,"E-3":0},"Multiple sequences":{"Followup, days":null,"Subjects with":0},"Network Summary":{Clusters:session.data.clusters.length,Edges:e.length,Nodes:session.data.nodes.length,"Sequences used to make links":n.size()},Nodes:session.data.nodes.map(function(e){return{attributes:[],baseline:null,cluster:e.cluster,edi:null,id:e.id,patient_attributes:e}}),patient_attribute_schema:i,Settings:{"contaminant-ids":[],contaminants:"remove","edge-filtering":"remove",threshold:session.state.linkThreshold}}},null,2)};t.a=a},12:function(e,t,n){"use strict";n.r(t);var s=n(1);function o(e){var t=e.name.split(".").pop().toLowerCase();if("zip"!==t){if("microbetrace"===t||"hivtrace"===t){var n=new FileReader;n.onloadend=function(e){s.a.processJSON(e.target.result,t)},n.readAsText(e,"UTF-8")}var o="xlsx"===t||"xls"===t;fileto.promise(e,o?"ArrayBuffer":"Text").then(function(e){session.files.push(e),i(e)})}else{(new JSZip).loadAsync(e).then(function(e){e.forEach(function(e,n){t=n.name.split(".").pop(),n.async("string").then(function(e){s.a.processJSON(e,t)})})})}}function i(e){var t=e.name.split(".").pop(),n=t.indexOf("fas")>-1,o="xlsx"===t||"xls"===t,i=e.name.toLowerCase().includes("node");if(o){var a=XLSX.read(e.contents,{type:"array"}),r=XLSX.utils.sheet_to_json(a.Sheets[a.SheetNames[0]]);l(Object.keys(r[0]).map(filterXSS))}else Papa.parse(e.contents,{dynamicTyping:!0,header:!0,preview:1,complete:function(e){l(e.meta.fields.map(filterXSS))}});function l(t){var o=$('<div class="file-table-row"></div>'),a=$('<div class="row w-100"></div>');$('<div class="file-name col"></div>').append($('<a href="#"><span class="oi oi-circle-x"></span></a>').click(function(t){session.files.splice(session.files.indexOf(e.name),1),o.slideUp(function(){o.remove()})})).append($('<a href="#"><span class="oi oi-data-transfer-download"></span></a>').on("click",function(t){var n=new Blob([e.contents],{type:"text"|e.type});saveAs(n,e.name)})).append('&nbsp;<a href="#" title="'.concat(e.name,'">').concat(e.name,"</a>")).appendTo(a),a.append('\n    <div class="btn-group btn-group-toggle btn-group-sm" data-toggle="buttons">\n      <label class="btn btn-light'.concat(!n&!i?" active":"",'">\n        <input type="radio" name="options-').concat(e.name,'" data-type="link" autocomplete="off"').concat(!n&!i?" checked":"",'>Link</input>\n      </label>\n      <label class="btn btn-light').concat(!n&i?" active":"",'">\n        <input type="radio" name="options-').concat(e.name,'" data-type="node" autocomplete="off"').concat(!n&i?" checked":"",'>Node</input>\n      </label>\n      <label class="btn btn-light">\n        <input type="radio" name="options-').concat(e.name,'" data-type="distmat" autocomplete="off">Dist. Mat.</input>\n      </label>\n      <label class="btn btn-light').concat(n?" active":"",'">\n        <input type="radio" name="options-').concat(e.name,'" data-type="fasta" autocomplete="off"').concat(n?" checked":"",">FASTA</input>\n      </label>\n    </div>\n    ")),a.appendTo(o);var r=$('<div class="row w-100"></div>'),l="<option>None</option>"+t.map(function(e){return'<option value="'+e+'">'+s.a.titleize(e)+"</option>"}).join("\n");function c(n){var s="node"===n?["ID","Id","id"]:["SOURCE","Source","source"],o="node"===n?["SEQUENCE","SEQ","Sequence","sequence","seq"]:["TARGET","Target","target"];these=$("[data-file='".concat(e.name,"'] select")),[s,o,["length","Length","distance","Distance","snps","SNPs","tn93","TN93"]].forEach(function(e,s){e.forEach(function(e){t.includes(e)&&$(these.get(s)).val(e)}),"None"===$(these.get(s)).val()&&(1===s&&"node"===n||$(these.get(s)).val(t[s]))})}function d(t){var n=$(t?t.target:'[name="options-'.concat(e.name,'"]:checked')).data("type"),s=$("[data-file='".concat(e.name,"']")),o=$(s.get(0)),i=$(s.get(1));third=$(s.get(2)),"node"===n?(o.slideDown().find("label").text("ID"),i.slideDown().find("label").text("Sequence"),third.slideUp(),c(n)):"link"===n?(o.slideDown().find("label").text("Source"),i.slideDown().find("label").text("Target"),third.slideDown(),c(n)):s.slideUp()}r.append("\n    <div class='col-4 '".concat(n?' style="display: none;"':""," data-file='").concat(e.name,"'>\n      <label for=\"file-").concat(e.name,'-field-1">').concat(i?"ID":"Source",'</label>\n      <select id="file-').concat(e.name,'-field-1" class="custom-select custom-select-sm">').concat(l,"</select>\n    </div>\n    <div class='col-4 '").concat(n?' style="display: none;"':""," data-file='").concat(e.name,"'>\n      <label for=\"file-").concat(e.name,'-field-2">').concat(i?"Sequence":"Target",'</label>\n      <select id="file-').concat(e.name,'-field-2" class="custom-select custom-select-sm">').concat(l,"</select>\n    </div>\n    <div class='col-4 '").concat(n?' style="display: none;"':""," data-file='").concat(e.name,"'>\n      <label for=\"file-").concat(e.name,'-field-3">Distance</label>\n      <select id="file-').concat(e.name,'-field-3" class="custom-select custom-select-sm">').concat(l,"</select>\n    </div>\n    ")),r.appendTo(o),o.appendTo("#file-table"),c($('[name="options-'.concat(e.name,'"]:checked')).data("type")),$('[name="options-'.concat(e.name,'"]')).change(d),d()}}function a(){var e=0,t=[],n=session.files.filter(function(e){return e.name.split(".").pop().includes("fas")});0!==n.length&&n.forEach(function(o){s.a.parseFASTA(o.contents).forEach(function(e){e.id=filterXSS(e.id),e.seq=filterXSS(e.seq),t.push(e)}),++e===n.length&&function(e){$("#alignmentPreview").empty().append('<img src="img/spinner.gif" class="mx-auto" />'),s.a.align({nodes:e,reference:session.data.reference,aligner:$('input[name="shouldAlign"]:checked').data("aligner"),isLocal:$("#localAlign").is(":checked"),match:[parseFloat($("#alignerMatch").val()),-parseFloat($("#alignerMismatch").val())],gap:[-parseFloat($("#alignerGapO").val()),-parseFloat($("#alignerGapE").val())]},function(e){alignmentViewer(e,{showID:!1}).then(function(e){$("#alignmentPreview").empty().append(e)})})}(t)})}function r(e){l.push(e),$("#loading-information").html(l.join("<br />"))}session.files.length>0&&($("#file-prompt").remove(),session.files.forEach(i)),$("#data-files").on("change",function(e){var t=e.target.files;$("#file-prompt").remove();for(var n,s=0;n=t[s];s++)o(n);$("#main-submit").css("display","inline").focus()}).filestyle({text:"Add File(s)",input:!1,btnClass:"btn-primary"}),$("#file-panel").on("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy"}).on("drop",function(e){e.stopPropagation(),e.preventDefault();var t=e.originalEvent.dataTransfer.files;t.length;$("#file-prompt").remove();for(var n,s=0;n=t[s];s++)o(n);$("#main-submit").css("display","inline").focus()}),$(".alignConfigRow").hide(),$("#swAlign").parent().click(function(){$(".alignConfigRow").slideDown(),$("#alignmentPreview").slideUp(function(){$(this).empty().show()})}),$("#doNotAlign, #nbeamAlign").parent().click(function(){$(".alignConfigRow").slideUp(),$("#alignmentPreview").slideUp(function(){$(this).empty().show()})}),$("#refSeqFileLoad").on("change",function(e){var t=e.target.files[0],n=new FileReader;n.onloadend=function(e){if(e.target.readyState==FileReader.DONE){var n=s.a.parseFASTA(e.target.result)[0];session.data.reference=filterXSS(n.seq),$('label[for="refSeqFileLoad"]').text("".concat(t.name," (").concat(filterXSS(n.id),")")),a()}},n.readAsText(t)}),$("#alignerControlsButton, #previewAlignment").click(a),$("#distance-metrics").chosen({width:"100%"}).change(function(e){$("#default-distance-metric, #links-filter-variable").html($(this).val().map(function(e,t){return'<option value="'+e+'"'+(0==t?" selected":"")+">"+s.a.titleize(e)+"</option>"}).join("\n")).trigger("change"),session.state.metrics=$(this).val()}),$("#default-distance-metric, #links-filter-variable").change(function(e){session.state.linkSortVariable=e.target.value,$("#default-distance-metric, #links-filter-variable").val(session.state.linkSortVariable),"snps"===session.state.linkSortVariable?$("#default-distance-threshold, #link-threshold").attr("step",1).val(16):$("#default-distance-threshold, #link-threshold").attr("step",.001).val(.015)}),$("#stash-auto-yes").parent().on("click",function(){localStorage.setItem("stash-auto","true")}),"true"===localStorage.getItem("stash-auto")&&$("#stash-auto-yes").parent().trigger("click"),$("#stash-auto-no").parent().on("click",function(){temp.autostash&&clearInterval(temp.autostash.interval),localStorage.setItem("stash-auto","false")}),localStorage.getItem("default-View")&&$("#default-View").val(localStorage.getItem("default-View")),$("#default-View").change(function(e){localStorage.setItem("default-View",e.target.value),session.layout.content[0].type=e.target.value});var l=[];$("#main-submit").click(function(e){session.meta.startTime=Date.now(),l=[],$("#SettingsTab").attr("data-target","#global-settings-modal"),session.data=s.a.dataSkeleton(),$("#loading-information").html(""),$("#loading-information-modal").modal({backdrop:!1,keyboard:!1}),setTimeout(function(){$("#loadCancelButton").slideDown(),alertify.warning("If you stare long enough, you can reverse the DNA Molecule's spin direction")},2e4),$("#file-panel .file-table-row").each(function(e,t){var n=$(t),s=n.find(".file-name").text().trim(),o=n.find("select"),i=session.files.find(function(e){return e.name===s});i.format=n.find('input[type="radio"]:checked').data("type"),i.field1=o.get(0).value,i.field2=o.get(1).value,i.field3=o.get(2).value});var t=["distmat","link","node","fasta"],n=!1;session.state.metrics=$("#distance-metrics").val(),session.data.linkFields=session.data.linkFields.concat(session.state.metrics);var o=session.files.length>1;function i(){if(!n)return $(".show-for-seq").hide(),void s.a.finishUp();session.data.nodeFields.push("seq"),$(".show-for-seq").show(),$(".show-for-seq.row").css("display","flex");var e=/^-*$/,t=session.data.nodes.filter(function(t){return!e.test(t.seq)});$("#doNotAlign").is(":checked")?a(t):(r("Aligning Sequences..."),s.a.align({reference:session.data.reference,aligner:$('input[name="shouldAlign"]:checked').data("aligner"),isLocal:$("#localAlign").is(":checked"),match:[$("#alignerMatch").val(),$("#alignerMismatch").val()].map(parseFloat),gap:[$("#alignerGapO").val(),$("#alignerGapE").val()].map(parseFloat),nodes:t},function(e){t.forEach(function(t){var n=e.find(function(e){return e.id===t.id});n&&Object.assign(t,n)}),a(t)}))}function a(e){r("Computing Links based on Genomic Proximity..."),s.a.computeConsensus(function(t){session.data.consensus=t,s.a.computeConsensusDistances(function(t){for(var n=t.length,o=0;o<n;o++){var i=t[o];session.data.nodes[i.index]._diff=i._diff}s.a.computeLinks(e,function(e){r(" - Found ".concat(e," New Links from Genomic Proximity")),s.a.finishUp()})})}),session.data.nodeFields.push("_diff")}session.files.sort(function(e,n){return t.indexOf(e.format)-t.indexOf(n.format)}),session.files.forEach(function(e,t){var a=e.name,l=a.split(".").pop().toLowerCase();if("fasta"===e.format){r("Parsing ".concat(a," as FASTA..."));var c=Date.now();n=!0;for(var d=0,u=s.a.parseFASTA(e.contents),A=u.length,f=0;f<A;f++){var p=u[f];p&&(p.id=filterXSS(p.id),p.seq=filterXSS(p.seq),p.origin=[a],d+=s.a.addNode(p))}console.log("FASTA Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(d," New, ").concat(u.length," Total Nodes from FASTA.")),t===session.files.length-1&&i()}else if("link"===e.format){var m=function(t){Object.keys(t).forEach(function(e){t[e]=filterXSS(t[e])});var n={source:""+t[e.field1],target:""+t[e.field2],origin:[a],visible:!0};session.state.metrics.forEach(function(e){e=e.toLowerCase(),n[e]=null});var i=parseFloat(t[e.field3]);_.isNumber(i)&&!_.isNaN(i)?n[session.state.linkSortVariable]=i:n[session.state.linkSortVariable]=0,g+=s.a.addLink(Object.assign(n,t),o)};r("Parsing ".concat(a," as Link List..."));c=Date.now();var g=0;if("xls"==l||"xlsx"==l){var T=XLSX.read(e.contents,{type:"array"});(G=XLSX.utils.sheet_to_json(T.Sheets[T.SheetNames[0]])).map(m),r(" - Parsed ".concat(g," New, ").concat(G.length," Total Links from Link Excel Table.")),Object.keys(G[0]).forEach(function(e){e=filterXSS(e),session.data.linkFields.includes(e)||session.data.linkFields.push(e)});A=0;var h=(y=_.union(_.map(G,function(t){return t[e.field1]}),_.map(G,function(t){return t[e.field2]}))).length;y.forEach(function(e){A+=s.a.addNode({id:""+e,origin:[a]})}),console.log("Link Excel Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(A," New, ").concat(h," Total Nodes from Link Excel Table.")),t===session.files.length-1&&i()}else Papa.parse(e.contents,{header:!0,worker:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:function(n){var o=n.data;o.map(m),r(" - Parsed ".concat(g," New, ").concat(o.length," Total Links from Link CSV.")),n.meta.fields.forEach(function(e){e=filterXSS(e),session.data.linkFields.includes(e)||session.data.linkFields.push(e)});var l=0,d=_.union(_.map(o,function(t){return t[e.field1]}),_.map(o,function(t){return t[e.field2]})),u=d.length;d.forEach(function(e){l+=s.a.addNode({id:""+e,origin:[a]})}),console.log("Link CSV Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(l," New, ").concat(u," Total Nodes from Link CSV.")),t===session.files.length-1&&i()}})}else if("node"===e.format){r("Parsing ".concat(a," as Node List..."));c=Date.now();"None"!==e.field2&&(n=!0);var C=0;A=0;if("xls"==l||"xlsx"==l){T=XLSX.read(e.contents,{type:"array"});var G=XLSX.utils.sheet_to_json(T.Sheets[T.SheetNames[0]]);Object.keys(G[0]).forEach(function(e){e=filterXSS(e),session.data.nodeFields.includes(e)||session.data.nodeFields.push(e)}),G.forEach(function(t){(p=JSON.parse(filterXSS(JSON.stringify(t)))).id=""+p[e.field1],"None"!==e.field2&&(p.seq=p[e.field2]),p.origin=[a],C+=s.a.addNode(p)}),console.log("Node Excel Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(C," New, ").concat(A," Total Nodes from Node Excel Table.")),t===session.files.length-1&&i()}else Papa.parse(e.contents,{header:!0,worker:!0,dynamicTyping:!0,skipEmptyLines:!0,step:function(t){0==A++&&t.meta.fields.forEach(function(e){e=filterXSS(e),session.data.nodeFields.includes(e)||session.data.nodeFields.push(e)}),(p=JSON.parse(filterXSS(JSON.stringify(t.data[0])))).id=""+p[e.field1],"None"!==e.field2&&(p.seq=p[e.field2]),p.origin=[a],C+=s.a.addNode(p)},complete:function(){console.log("Node CSV Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(C," New, ").concat(A," Total Nodes from Node CSV.")),t===session.files.length-1&&i()}})}else{r("Parsing ".concat(a," as Distance Matrix..."));c=Date.now();var v=session.state.linkSortVariable;if("xls"==l||"xlsx"==l){T=XLSX.read(e.contents,{type:"array"}),G=XLSX.utils.sheet_to_json(T.Sheets[T.SheetNames[0]],{header:1});var y=[],b=0,w=0;G.forEach(function(e,t){if(0==t)(y=e.map(filterXSS)).forEach(function(e,t){t>0&&(b+=s.a.addNode({id:""+e,origin:[a]}))});else{var n=""+e[0];e.forEach(function(e,t){if(0!==t){var o=""+y[t];if(n!==o){var i={source:n,target:o,origin:[a]};session.state.metrics.forEach(function(e){e=e.toLowerCase(),i[e]=0}),i[v]=parseFloat(e),w+=s.a.addLink(i,!0)}}})}}),console.log("Distance Matrix Excel Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(b," New, ").concat(G.length-1," Total Nodes from Excel Distance Matrix.")),r(" - Parsed ".concat(w," New, ").concat((Math.pow(G.length-1,2)-(G.length-1))/2," Total Links from Excel Distance Matrix.")),t===session.files.length-1&&i()}else Papa.parse(e.contents,{worker:!0,skipEmptyLines:!0,complete:function(e){var n=[],o=0,l=0;session.files.length;e.data.forEach(function(e,t){if(0===t)(n=e.map(filterXSS)).forEach(function(e,t){t>0&&(o+=s.a.addNode({id:""+e,origin:[a]}))});else{var i=""+e[0];e.forEach(function(e,t){if(0!==t){var o=""+n[t];if(i!==o){var r={source:i,target:o,origin:[a]};session.state.metrics.forEach(function(e){e=e.toLowerCase(),r[e]=0}),r[v]=parseFloat(e),l+=s.a.addLink(r,!0)}}})}}),console.log("Distance Matrix CSV Parse time:",((Date.now()-c)/1e3).toLocaleString(),"s"),r(" - Parsed ".concat(o," New, ").concat(e.data.length-1," Total Nodes from Distance Matrix.")),r(" - Parsed ".concat(l," New, ").concat((Math.pow(e.data.length-1,2)-(e.data.length-1))/2," Total Links from Distance Matrix.")),t===session.files.length-1&&i()}})}})})}});