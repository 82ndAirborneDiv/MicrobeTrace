!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){$(function(){"use strict";$.getJSON("package.json",function(e){$("#version").html(e.version)}),navigator.onLine&&$(".ifOnline").show(),window.session=app.sessionSkeleton(),window.layout=new window.GoldenLayout({settings:{selectionEnabled:!0,showPopoutIcon:!1},content:[{type:"stack",content:[]}]},$("#main_panel")),layout.init(),layout.contentItems=[],app.launchView("files"),localStorage.getItem("licenseAccepted")||($("#acceptAgreement").click(function(){localStorage.setItem("licenseAccepted",new Date)}),$("#rejectAgreement").click(function(){}),$("#licenseAgreement").modal({backdrop:"static",keyboard:!1})),$("#FileTab").click(app.reset),$("#SaveTab").click(function(){var e=new Blob([JSON.stringify(session)],{type:"application/json;charset=utf-8"});saveAs(e,$("#save-file-name").val()+".microbetrace")}),$("#OpenTab").change(function(e){if(e.target.files.length>0){var t=new FileReader;t.onloadend=function(e){session=JSON.parse(e.target.result),app.launchView("2d_network")},t.readAsText(e.target.files[0],"UTF-8")}}),$("#ImportTab").change(function(e){if(e.target.files.length>0){var t=new FileReader;t.onloadend=function(e){session=app.sessionSkeleton(),app.parseHIVTrace(JSON.parse(e.target.result)),app.launchView("2d_network"),$("#linkSortVariable").html(session.data.linkFields.map(function(e){return'<option value="'+e+'"'+("distance"===e?" selected":"")+">"+app.titleize(e)+"</option>"}).join("\n"));try{app.updateThresholdHistogram()}catch(e){console.error(e),app.reset()}app.setLinkVisibility(),app.setNodeVisibility(),app.tagClusters(),app.computeDegree(),setTimeout(function(){session.network.render(),session.network.force.alpha(.3).alphaTarget(0).restart(),session.network.updateStatistics(),session.loadTime=Date.now()-session.startTime,$(".hideForHIVTrace").hide(),setTimeout(session.network.fit,1500)},80)},t.readAsText(e.target.files[0],"UTF-8")}}),$("#ExitTab").click(function(){window.open("","_self").close()}),$("#FindTab").click(function(e){$("#search").focus()}),$("#AddDataTab").click(function(){app.launchView("files")}),$("#RevealAllTab").click(function(e){session.data.clusters.forEach(function(e){e.visible=1}),$("#HideSingletons").prop("checked",!1).parent().removeClass("active"),$("#ShowSingletons").prop("checked",!0).parent().addClass("active"),app.setLinkVisibility(),app.setNodeVisibility()}),$(".viewbutton").click(function(){app.launchView($(this).data("href"))}),$("#ReloadTab").click(function(){window.location.reload(!0)}),$("#FullScreenTab").click(function(){screenfull.toggle()}),$("#UpdateTab").click(function(){"serviceWorker"in navigator?navigator.serviceWorker.register("sw.js",{scope:"/"}).then(function(e){e.installing||e.waiting?alertify.warning("MicrobeTrace is Updating..."):e.active&&alertify.success("You're running the latest available version of MicrobeTrace!")}).catch(function(e){alertify.error("MicrobeTrace failed to Update!"),console.log(e)}):alertify.warning("Old Browser Detected!\nPlease consider updating!")}),$("#computeMST").click(function(){$(".showForNotMST").fadeOut(function(){$(".showForMST").fadeIn()})}),$("#showMSTLinks, #showAllLinks").change(function(){app.setLinkVisibility(),app.tagClusters(),$("#HideSingletons").is(":checked")&&app.setNodeVisibility(),app.computeDegree()}),$("#ShowSingletons, #HideSingletons").change(app.setNodeVisibility),app.updateThresholdHistogram=function(){for(var e=280,t=d3.select("svg#link-threshold-sparkline").html(null).attr("width",e).attr("height",48),n=$("#linkSortVariable").val(),i=session.data.links.length,a=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Array(i),r=0;r<i;r++){var l=parseFloat(session.data.links[r][n]);s[r]=l,l<o&&(o=l),l>a&&(a=l)}var c=a-o,p=(l=d3.scaleLinear().domain([o,a]).range([0,e]),d3.histogram().domain(l.domain()).thresholds(l.ticks(40))(s)),d=d3.scaleLinear().domain([0,d3.max(p,function(e){return e.length})]).range([48,0]);function u(){var n=d3.mouse(t.node())[0];session.state.linkThreshold=n/e*c+o,$("#default-link-threshold").val(parseFloat(session.state.linkThreshold.toLocaleString())),$(window).trigger("updateThreshold")}t.selectAll(".bar").data(p).enter().append("g").attr("class","bar").attr("transform",function(e){return"translate("+l(e.x0)+","+d(e.length)+")"}).append("rect").attr("x",1).attr("width",6).attr("height",function(e){return 48-d(e.length)}),t.on("click",function(){u(),app.setLinkVisibility(),app.tagClusters(),$("#HideSingletons").is(":checked")&&app.setNodeVisibility(),app.computeDegree(),session.network.render(),session.network.updateStatistics(),session.network.force.alpha(.3).alphaTarget(0).restart()}),t.on("mousedown",function(){d3.event.preventDefault(),t.on("mousemove",u),t.on("mouseup",function(){app.setLinkVisibility(),app.tagClusters(),$("#HideSingletons").is(":checked")&&app.setNodeVisibility(),app.computeDegree(),session.network.render(),session.network.updateStatistics(),session.network.force.alpha(.3).alphaTarget(0).restart(),t.on("mousemove",null).on("mouseup",null)})}),session.state.linkThreshold=parseFloat($("#defaultDistanceThreshold").val()),$("#default-link-threshold").val(parseFloat(session.state.linkThreshold.toLocaleString())),$(window).trigger("updateThreshold")},$("#linkSortVariable").on("change",app.updateThresholdHistogram),$("#default-link-threshold").on("input",function(){app.setLinkVisibility(),app.tagClusters(),$("#HideSingletons").is(":checked")&&app.setNodeVisibility(),app.computeDegree(),$(window).trigger("updateThreshold")}),$("#export-data").click(function(){var e=$("#export-file-format").val(),t=$("#export-file-name").val(),n=new Blob([app.exportHIVTRACE()],{type:"application/json;charset=utf-8"});saveAs(n,t+"."+e)}),$("form").on("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())}),$("#search").on("input",function(e){""===e.target.value?session.data.nodes.forEach(function(e){e.selected=0}):(session.data.nodes.forEach(function(t){t.selected=t.id.indexOf(e.target.value)>-1}),session.data.nodes.some(function(e){return e.selected})||alertify.warning("No matches!")),$(window).trigger("node_selected")}),$(document).on("keydown",function(e){e.ctrlKey&&"f"===e.key&&(e.preventDefault(),$("#search").focus())}),$(window).on("resize",function(){layout.root.setSize()})}),alertify.defaults.transition="slide",alertify.defaults.theme.ok="btn btn-primary",alertify.defaults.theme.cancel="btn btn-danger",alertify.defaults.theme.input="form-control"}]);